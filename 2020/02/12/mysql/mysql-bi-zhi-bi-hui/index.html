<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="MySQL必知必会, Lzh&#39;s Blog">
    <meta name="description" content="MySQL读书笔记">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MySQL必知必会 | Lzh&#39;s Blog</title>
    <link rel="icon" type="image/png" href="/medias/logo1.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.1.1"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo1.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Lzh's Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo1.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Lzh's Blog</div>
        <div class="logo-desc">
            
            努力过好每一天
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/codinghit" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Github
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #44c7ab;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/codinghit" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Github" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('http://cdn.codezhuang.top/2_13.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">MySQL必知必会</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/MySQL/">
                                <span class="chip bg-color">MySQL</span>
                            </a>
                        
                            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                <span class="chip bg-color">数据库</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/MySQL/" class="post-category">
                                MySQL
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-02-12
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    12.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    49 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>

        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="一-显示数据"><a href="#一-显示数据" class="headerlink" title="一. 显示数据"></a>一. 显示数据</h2><ul>
<li><p>mysql -u root -p 123456 -h localhost -P 3306<br>运行mysql，参数-u为用户名，-p为密码，-h为主机名，-P端口号</p>
</li>
<li><p><code>USE database01;</code><br>使用database01这个数据库</p>
</li>
<li><p><code>SHOW DATABASES;</code><br>显示所有数据库</p>
</li>
<li><p><code>SHOW TABLES;</code><br>显示当前数据库下的所有表单</p>
</li>
<li><p><code>SHOW COLUMNS FRON students;</code>或<br><code>DESCRIBE students;</code><br>显示students这张表的所有列</p>
</li>
<li><p><code>SHOW STATUS;</code><br>显示广泛的服务器状态信息</p>
</li>
<li><p><code>SHOW CREATE DATABASE;</code> 或 <code>SHOW CREATE TABLE;</code><br>显示创建的数据库和表单</p>
</li>
<li><p><code>HELP SHOW;</code><br>显示允许的SHOW语句</p>
</li>
</ul>
<h2 id="二-检索数据"><a href="#二-检索数据" class="headerlink" title="二. 检索数据"></a>二. 检索数据</h2><ul>
<li><p><code>SELECT name , age FROM students;</code><br>检索students表中name列和age列中的每一行</p>
</li>
<li><p><code>SELECT * FROM students;</code><br>检索sutdents表中所有列的每一行</p>
</li>
<li><p><code>SELECT DISTINCT name，age FROM students;</code><br>分别检索students表中name列和age列的不同的行<br><font color="red" size="3">注意：DISTINCT关键字应用于所有列而不仅是前置它的列</font></p>
</li>
<li><p><code>SELECT name FROM students LIMIT 5;</code><br>检索students表中name列的前5行</p>
</li>
<li><p><code>SELECT name FROM students LIMIT 5,5;</code><br>检索students表中name列从第5行开始(不包括第5行)的下一个5行的</p>
</li>
<li><p><font color="red" size="3">注意：检索出来的第一行为行0，而不是行1，因此LIMIT 1 1 检索出来的是第二行的数据而不是第一行</font></p>
</li>
</ul>
<h2 id="三-排序检索数据"><a href="#三-排序检索数据" class="headerlink" title="三. 排序检索数据"></a>三. 排序检索数据</h2><ul>
<li><p><code>SELECT name FROM studnets ORDER BY name;</code><br>按name列的字母顺序排序students表中的name列</p>
</li>
<li><p><code>SELECT id , price , name FROM students ORDER BY price , name;</code><br>先按price列的顺序排序，如果price相等则再按name顺序排序students表中的id,price,name列</p>
</li>
<li><p><code>SELECT id , price , name FROM students ORDER BY price DESC;</code><br>按price列的降序排序sutdents表中的id,price,name列。默认为升序(ASC)</p>
</li>
<li><p><code>SELECT id, price, name FROM students ORDER BY price DESC, name;</code><br>先按price的降序排序，如果price相同则按name列的升序排列<br><font size="3" color="red">注意：DESC只应用到直接位于前面的列，后面的列仍然为默认的升序</font></p>
</li>
<li><p><code>SELECT price FROM products ORDER BY price DESC LIMIT 1;</code><br>检索出price列中最大的值</p>
</li>
</ul>
<h2 id="四-过滤数据"><a href="#四-过滤数据" class="headerlink" title="四. 过滤数据"></a>四. 过滤数据</h2><ul>
<li><p><code>SELECT id, price FROM products WHERE price = 2.50;</code><br>检索price=2.50的products表中的id列和price列</p>
</li>
<li><p><code>SELECT name, price FROM products WHERE name = &#39;fuses&#39;;</code><br>检索name=’fuses’的products表中name列和price列。<font size="3" color="red">注意：MySQL在匹配字符串时默认不区分大小写</font></p>
</li>
<li><p><code>SELECT id, name FROM products WHERE id &lt;&gt; 1003;</code> 或 <code>SELECT id, name FROM products WHERE id != 1003;</code><br>检索id不等于1003的products表中的id列和name列</p>
</li>
<li><p><code>SELECT name, price FROM products WHERE price BETWEEN 30 AND 50;</code><br>检索price值为30到50之间的products表中的name列和name列</p>
</li>
<li><p><code>SELECT name FROM products WHERE price IS NULL;</code><br>检索price列中为NULL的products表中的name列</p>
</li>
<li><p>在同时使用ORDER BY和WHERE时，应该让ORDER BY位于WHERE之后，否则将会产生错误</p>
</li>
</ul>
<h2 id="五-数据过滤"><a href="#五-数据过滤" class="headerlink" title="五.数据过滤"></a>五.数据过滤</h2><ul>
<li><p><code>SELECT id, price, name FROM products WHERE id = 1003 AND price &lt;= 10;</code><br>检索id=1003的并且price&lt;=10的products表中的id列，price列和name列</p>
</li>
<li><p><code>SELECT id, price, name FROM products WHERE id = 1002 OR id = 1003;</code><br>检索id=1002或者id=1003的products表中id列，price列和name列</p>
</li>
<li><p><code>SELECT id, price, name FROM products WHERE id = 1002 OR id = 1003 AND price &gt;= 10;</code><br>AND的优先级大于OR的优先级，因此会先执行后面两个字句，再执行第一个字句。最好是加括号能够更加明显的区别.SELECT id, price, name FROM products WHERE id = 1002 OR (id = 1003 AND price &gt;= 10);</p>
</li>
<li><p><code>SELECT name, price FROM products WHERE id IN (1002,1003) ORDER BY name;</code><br>检索所有id为1002与1003的products表中的name, price列并按name字段升序排列。此时与SELECT id, price, name FROM products WHERE id = 1002 OR id = 1003 ORDER BY name;语句的意思一样</p>
</li>
<li><p>IN操作符的优点：</p>
<ul>
<li>IN操作符的语法更清楚且更直观</li>
<li>在使用IN时，计算的次序更容易管理</li>
<li>IN操作符比OR操作符清单执行更快</li>
<li>IN的最大优点是可以包含其他SELECT语句，使得能够更动态地建立WHERE子句</li>
</ul>
</li>
<li><p><code>SELECT name, price FROM products WHERE id NOT IN (1002,1003) ORDER BY name;</code><br>检索id不为1002和1003的products表中name列，price列并按name列升序排列 </p>
</li>
</ul>
<h2 id="六-用通配符进行过滤"><a href="#六-用通配符进行过滤" class="headerlink" title="六. 用通配符进行过滤"></a>六. 用通配符进行过滤</h2><h3 id="1-百分号-通配符"><a href="#1-百分号-通配符" class="headerlink" title="1. 百分号(%)通配符"></a>1. 百分号(%)通配符</h3><p>%表示任何字符出现的次数。包括0次、1次….n次。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'jet%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>检索name列中以jet开头的字符串</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'s%e'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>检索name列中以s开头e结尾的字符串</p>
<h3 id="2-下划线-通配符"><a href="#2-下划线-通配符" class="headerlink" title="2. 下划线(_)通配符"></a>2. 下划线(_)通配符</h3><p>下划线(_)只匹配单个字符而不是多个字符</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">LIKE</span> <span class="token string">'_ton'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>检索name列中字符串长度为4的且后面3个字符为ton的字符串</p>
<h3 id="3-使用通配符的技巧"><a href="#3-使用通配符的技巧" class="headerlink" title="3. 使用通配符的技巧"></a>3. 使用通配符的技巧</h3><ul>
<li>不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。</li>
<li>在确实需要使用通配符时，除非绝对有必要，否则不要把它们用在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起来是最慢的。</li>
<li>仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。</li>
</ul>
<h2 id="七-使用正则表达式进行搜索"><a href="#七-使用正则表达式进行搜索" class="headerlink" title="七. 使用正则表达式进行搜索"></a>七. 使用正则表达式进行搜索</h2><h3 id="1-基本字符匹配"><a href="#1-基本字符匹配" class="headerlink" title="1. 基本字符匹配"></a>1. 基本字符匹配</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'1000'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>检索name列中含有1000这个字符串的行。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'.000'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>.是正则表达式语言中一个特殊的字符。它表示匹配任意一个字符。因此，字符串1000和2000都匹配且返回。</p>
<ul>
<li><font size="3" color="red">注意：匹配字符串时不区分大小写，为区分大小写，可使用BINARY关键字。如WHERE name REGEXP BINARY ‘Jet Pack’;</font></li>
</ul>
<h3 id="2-进行OR匹配"><a href="#2-进行OR匹配" class="headerlink" title="2. 进行OR匹配"></a>2. 进行OR匹配</h3><p>搜索两个字符串之一，使用|这个符号</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> prodcts <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'1000|2000'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>检索name列中含有1000和2000的字符串。</p>
<h3 id="3-匹配几个字符之一"><a href="#3-匹配几个字符之一" class="headerlink" title="3. 匹配几个字符之一"></a>3. 匹配几个字符之一</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'[123] Tom'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这里，使用正则表达式[123] Ton。[123]定义一组字符，它的意思是匹配1或2或3,因此，1 ton和2 ton都匹配且返回。</p>
<h3 id="4-匹配范围"><a href="#4-匹配范围" class="headerlink" title="4. 匹配范围"></a>4. 匹配范围</h3><p>[1-3] 匹配1到3的整数。<br>[a-z] 匹配任意字母字符。</p>
<h3 id="5-匹配特殊字符"><a href="#5-匹配特殊字符" class="headerlink" title="5. 匹配特殊字符"></a>5. 匹配特殊字符</h3><p>为了检索. - []这些特殊字符，需要进行转义才能进行匹配。<br>如\\.可以匹配.</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'\\\\.'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>检索name列中含有.字符的字符串。</p>
<h3 id="6-匹配字符类"><a href="#6-匹配字符类" class="headerlink" title="6. 匹配字符类"></a>6. 匹配字符类</h3><table>
<thead>
<tr>
<th align="center">类</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">[:alnume:]</td>
<td align="center">任意字母和数字(同[a-zA-Z0-9])</td>
</tr>
<tr>
<td align="center">[:alpha:]</td>
<td align="center">任意字符(同[a-zA-Z])</td>
</tr>
<tr>
<td align="center">[:blank:]</td>
<td align="center">空格和制表(同[\t])</td>
</tr>
<tr>
<td align="center">[:cntrl:]</td>
<td align="center">ASCII控制字符(ASCII0到31和127)</td>
</tr>
<tr>
<td align="center">[:digit:]</td>
<td align="center">任意数字</td>
</tr>
<tr>
<td align="center">[:graph:]</td>
<td align="center">与[:print:]相同,但不包括空格</td>
</tr>
<tr>
<td align="center">[:lower:]</td>
<td align="center">任意小写字母(同[a-z])</td>
</tr>
<tr>
<td align="center">[:print:]</td>
<td align="center">任意可打印字符</td>
</tr>
<tr>
<td align="center">[:punct:]</td>
<td align="center">既不在[:alnum:]又不在[:cntrl:]中的任意字符</td>
</tr>
<tr>
<td align="center">[:space:]</td>
<td align="center">包括空格在内的任意空白字符(同[\f\n\r\t\v])</td>
</tr>
<tr>
<td align="center">[:upper:]</td>
<td align="center">任意大写字母(同[A-Z])</td>
</tr>
<tr>
<td align="center">[:xdigit:]</td>
<td align="center">任意十六进制数字(同[a-fA-F0-9])</td>
</tr>
</tbody></table>
<h3 id="7-匹配多个实例"><a href="#7-匹配多个实例" class="headerlink" title="7. 匹配多个实例"></a>7. 匹配多个实例</h3><table>
<thead>
<tr>
<th align="center">元字符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">*</td>
<td align="center">0个或多个匹配</td>
</tr>
<tr>
<td align="center">+</td>
<td align="center">1个或多个匹配(等于{1,})</td>
</tr>
<tr>
<td align="center">?</td>
<td align="center">0个或1个匹配(等于{0,1})</td>
</tr>
<tr>
<td align="center">{n}</td>
<td align="center">指定数目的匹配</td>
</tr>
<tr>
<td align="center">{n,}</td>
<td align="center">不少于指定书目的匹配</td>
</tr>
<tr>
<td align="center">{n,m}</td>
<td align="center">匹配数目的范围(m不超过255)</td>
</tr>
</tbody></table>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'[[:digit:]]{4}'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>匹配name列中连着一起的任意4为数字的字符串</p>
<h3 id="8-定位符"><a href="#8-定位符" class="headerlink" title="8. 定位符"></a>8. 定位符</h3><table>
<thead>
<tr>
<th align="center">元字符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">^</td>
<td align="center">文本的开始</td>
</tr>
<tr>
<td align="center">$</td>
<td align="center">文本的结尾</td>
</tr>
<tr>
<td align="center">[[:&lt;:]]</td>
<td align="center">词的开始</td>
</tr>
<tr>
<td align="center">[[:&gt;:]]</td>
<td align="center">词的结尾</td>
</tr>
</tbody></table>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> name <span class="token operator">REGEXP</span> <span class="token string">'^[0-9\\.]'</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>^匹配串的开始，因此，^[0-9\.]只在.或任意数字为串中第一个字符时才匹配它们。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li>^的双重用途：^有两种用法。在集合中(用[和]定义)，用它来否定该集合，否则，用来指串的开始处。</li>
<li>简单的正则表达式测试：可以在不使用数据库表的情况下用SELECT来测试正则表达式。REGEXP检查总是返回0(没有匹配)或1(匹配)。可以用带文字串的REGEXP来测试表达式,并试验它们。相应的语法如下：</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token string">'hello'</span> <span class="token operator">REGEXP</span> <span class="token string">'[0-9]'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个例子显然返回0(因为文本hello中没有数字)。</p>
<h2 id="八-创建计算字段"><a href="#八-创建计算字段" class="headerlink" title="八. 创建计算字段"></a>八. 创建计算字段</h2><h3 id="1-拼接字段"><a href="#1-拼接字段" class="headerlink" title="1. 拼接字段"></a>1. 拼接字段</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> Concat<span class="token punctuation">(</span>name<span class="token punctuation">,</span><span class="token string">'('</span><span class="token punctuation">,</span>country<span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> vendors <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Concat()拼接串，包含name字段左括号country字段右括号。</p>
<ul>
<li>RTrim(name) 去掉右边字段的空格</li>
<li>LTrim(name) 去掉左边字段的空格</li>
<li>Trim(name) 去掉串左右两边的空格</li>
</ul>
<h3 id="2-别名"><a href="#2-别名" class="headerlink" title="2. 别名"></a>2. 别名</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> Concat<span class="token punctuation">(</span>RTrim<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'('</span><span class="token punctuation">,</span>RTrim<span class="token punctuation">(</span>country<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> title <span class="token keyword">FROM</span> vendors <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> name<span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将连接起来的字段赋予了title的名字</p>
<h3 id="3-执行算术计算"><a href="#3-执行算术计算" class="headerlink" title="3. 执行算术计算"></a>3. 执行算术计算</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> quantity<span class="token punctuation">,</span> item_price<span class="token punctuation">,</span> quantity<span class="token operator">*</span>item_price <span class="token keyword">AS</span> expanded_price <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> num <span class="token operator">=</span> <span class="token number">2005</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>直接加入四则运算符号即可</p>
<h3 id="4-测试计算"><a href="#4-测试计算" class="headerlink" title="4. 测试计算"></a>4. 测试计算</h3><p>SELECT提供了测试和实验函数与计算的一个很好的办法。省略FROM语句以便测试。</p>
<ul>
<li><code>SELECT Trim(&#39; abc&#39;) ;</code><br>将返回abc</li>
<li><code>SELECT 3*2;</code><br>将返回6</li>
<li><code>SELECT Now();</code><br>将返回当前日期和时间</li>
</ul>
<h2 id="九-使用数据处理函数"><a href="#九-使用数据处理函数" class="headerlink" title="九. 使用数据处理函数"></a>九. 使用数据处理函数</h2><h3 id="1-文本处理函数"><a href="#1-文本处理函数" class="headerlink" title="1. 文本处理函数"></a>1. 文本处理函数</h3><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Left()</td>
<td align="center">返回串左边的字符</td>
</tr>
<tr>
<td align="center">Length()</td>
<td align="center">返回串的长度</td>
</tr>
<tr>
<td align="center">Locate()</td>
<td align="center">找出串的一个子串</td>
</tr>
<tr>
<td align="center">Lower()</td>
<td align="center">将串转换为小写</td>
</tr>
<tr>
<td align="center">LTrim()</td>
<td align="center">去掉串左边的空格</td>
</tr>
<tr>
<td align="center">Right()</td>
<td align="center">返回串右边的字符</td>
</tr>
<tr>
<td align="center">RTrim()</td>
<td align="center">去掉串右边的空格</td>
</tr>
<tr>
<td align="center">Soundex()</td>
<td align="center">返回串的SOUNDEX值</td>
</tr>
<tr>
<td align="center">SubString()</td>
<td align="center">返回子串的字符</td>
</tr>
<tr>
<td align="center">Upper()</td>
<td align="center">将串转换为大写</td>
</tr>
</tbody></table>
<p>SOUNDEX是一个将任何文本串转换为描述其语音表示的字母数字模式的算法。<br>如 <code>Soundex(&#39;Y Lee&#39;) = Soundex(&#39;Y Lie&#39;)</code>， 返回为真，因为这两个串发音相似。</p>
<h3 id="2-日期和时间处理函数"><a href="#2-日期和时间处理函数" class="headerlink" title="2. 日期和时间处理函数"></a>2. 日期和时间处理函数</h3><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">AddDate()</td>
<td align="center">增加一个日期（天、周等）</td>
</tr>
<tr>
<td align="center">AddTime()</td>
<td align="center">增加一个时间（时、分等）</td>
</tr>
<tr>
<td align="center">CurDate()</td>
<td align="center">返回当前日期</td>
</tr>
<tr>
<td align="center">CurTime()</td>
<td align="center">返回当前时间</td>
</tr>
<tr>
<td align="center">Date()</td>
<td align="center">返回日期时间的日期部分</td>
</tr>
<tr>
<td align="center">DateDiff()</td>
<td align="center">计算连个日期之差</td>
</tr>
<tr>
<td align="center">Date_Add()</td>
<td align="center">高度灵活的日期运算函数</td>
</tr>
<tr>
<td align="center">Date_Format()</td>
<td align="center">返回一个格式化的日期或时间串</td>
</tr>
<tr>
<td align="center">Day()</td>
<td align="center">返回一个日期的天数部分</td>
</tr>
<tr>
<td align="center">DayOfWeek()</td>
<td align="center">对于一个日期，返回对应的星期几</td>
</tr>
<tr>
<td align="center">Hour()</td>
<td align="center">返回一个时间的小时部分</td>
</tr>
<tr>
<td align="center">Minute()</td>
<td align="center">返回一个时间的分钟部分</td>
</tr>
<tr>
<td align="center">Month()</td>
<td align="center">返回一个时间的月份部分</td>
</tr>
<tr>
<td align="center">Now()</td>
<td align="center">返回当前日期和时间</td>
</tr>
<tr>
<td align="center">Second()</td>
<td align="center">返回一个时间的秒部分</td>
</tr>
<tr>
<td align="center">Time()</td>
<td align="center">返回一个日期时间的时间部分</td>
</tr>
<tr>
<td align="center">Year()</td>
<td align="center">返回一个日期的年份部分</td>
</tr>
</tbody></table>
<p><font color="red">注意：日期的格式必须为yyyy-mm-dd格式</font></p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> <span class="token keyword">date</span> <span class="token operator">=</span> <span class="token string">'2005-09-01'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><font color="red">注意：如果date的数据类型为datetime,这种类型存储日期和时间，如果这样写date此时只能匹配2005-09-01 00:00:00的时间，而2005-09-01 00:00:01并不会被返回。如果只想比较日期最好是在date前面加Date()函数，如 <code>SELECT id, name FROM orders WHERE Date(date) = &#39;2005-09-01&#39;;</code></font></p>
<p>例子：查找2005年9月下的订单</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> <span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token operator">BETWEEN</span> <span class="token string">'2005-09-01'</span> <span class="token operator">AND</span> <span class="token string">'2005-09-30'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> Year<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2005</span> <span class="token operator">AND</span> Month<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="3-数值处理函数"><a href="#3-数值处理函数" class="headerlink" title="3. 数值处理函数"></a>3. 数值处理函数</h3><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Abs()</td>
<td align="center">返回一个数的绝对值</td>
</tr>
<tr>
<td align="center">Cos()</td>
<td align="center">返回一个角度的余弦</td>
</tr>
<tr>
<td align="center">EXp()</td>
<td align="center">返回一个数的指数值</td>
</tr>
<tr>
<td align="center">Mod()</td>
<td align="center">返回除操作的余数</td>
</tr>
<tr>
<td align="center">Pi()</td>
<td align="center">返回圆周率</td>
</tr>
<tr>
<td align="center">Rand()</td>
<td align="center">返回一个随机数</td>
</tr>
<tr>
<td align="center">Sin()</td>
<td align="center">返回一个角度的正弦</td>
</tr>
<tr>
<td align="center">Sqrt()</td>
<td align="center">返回一个数的平方根</td>
</tr>
<tr>
<td align="center">Tan()</td>
<td align="center">返回一个角度的正切</td>
</tr>
</tbody></table>
<h2 id="十-汇总数据"><a href="#十-汇总数据" class="headerlink" title="十.汇总数据"></a>十.汇总数据</h2><h3 id="1-AVG-函数"><a href="#1-AVG-函数" class="headerlink" title="1. AVG()函数"></a>1. AVG()函数</h3><p>AVG()可用来返回所有列的平均值，也可以用来返回特定列或行的平均值。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_price <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>返回prod_price的平均值<br><font color="red">注意：AVG()只能用于单个列</font></p>
<h3 id="2-COUNT-函数"><a href="#2-COUNT-函数" class="headerlink" title="2. COUNT()函数"></a>2. COUNT()函数</h3><p>利用COUNT()确定表中行的数目或符合特定条件的行的数目。<br>COUNT的两种使用方式：</p>
<ul>
<li>使用COUNT(*)对表中行的数目进行计数，不管表列中包含的是空值(NULL)还是非空值。</li>
<li>使用COUNT(column)对特定列中具有值的行进行计数，忽略NULL值。</li>
</ul>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_cust <span class="token keyword">FROM</span> customers<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>利用COUNT(*)对表中所有行计数</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>cust_email<span class="token punctuation">)</span> <span class="token keyword">AS</span> num_cust <span class="token keyword">FROM</span> customers<span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>返回cust_email列中有值得行进行计数<br><font color="red">注意：如果指定列名，则指定列的值为空的行被COUNT()函数忽略，但如果COUNT()函数中用的是星好(*)，则不忽略。</font></p>
<h3 id="3-MAX-函数"><a href="#3-MAX-函数" class="headerlink" title="3. MAX()函数"></a>3. MAX()函数</h3><p>MAX()返回指定列中的最大值，MAX要求指定列名。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> max_price <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>返回prod_price中最大的值<br><font color="red">注意：MAX()用于文本数据时，如果数据按相应的列排序，则MAX()返回最后一行。</font></p>
<h3 id="4-MIN-函数"><a href="#4-MIN-函数" class="headerlink" title="4. MIN()函数"></a>4. MIN()函数</h3><p>MIN()函数返回指定列的最小值，MIN()要求指定列名。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> max_price <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>返回prod_price中最小的值<br><font color="red">注意：MIX()用于文本数据时，如果数据按相应的列排序，则MAX()返回最前面的行。</font></p>
<h3 id="5-SUM-函数"><a href="#5-SUM-函数" class="headerlink" title="5. SUM()函数"></a>5. SUM()函数</h3><p>SUM()函数返回指定列值的和(总计)。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> items_ordered <span class="token keyword">FROM</span> orderitems<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>返回quantity这一列值得总和</p>
<h3 id="6-聚集不同的值"><a href="#6-聚集不同的值" class="headerlink" title="6. 聚集不同的值"></a>6. 聚集不同的值</h3><p>指定包含的值为不同的，则使用DISTINCT参数。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> avg_price <span class="token keyword">FROM</span> products<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>返回prod_price列中不同值的平均值。<br><font color="red">注意：使用DISTINCT必须指定列名，因此不能将DISTINCT用于COUNT(*)</font><br><font color="blue">建议：在用聚合函数计算时最好使用别名，便于区分</font></p>
<h2 id="十一-分组数据"><a href="#十一-分组数据" class="headerlink" title="十一.分组数据"></a>十一.分组数据</h2><h3 id="1-创建分组"><a href="#1-创建分组" class="headerlink" title="1. 创建分组"></a>1. 创建分组</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_prods <span class="token keyword">FROM</span> products <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>GROUP BY通过id进行分组。<br>GROUP BY的一些规定：</p>
<ul>
<li>GROUP BY子句可以包含任意数目的列，这使得能对分组进行嵌套，为数据分组提供更细致的控制。</li>
<li>在建立分组时，指定的所有分组都一起计算。</li>
<li>GROUP BY子句中列出的每个列都必须是检索李列或有效的表达式（但不能是聚集函数）。如果在SELECT中使用表达式，则必须在GROUP BY子句中指定相同的表达式。不能使用别名。</li>
<li>除聚集计算语句外，SELECT语句中的每个列都必须在GROUP BY子句中给出。</li>
<li>如果分组列中具有NULL值，则NULL将作为一个分组返回。如果列中有多行NULL值，它们将分为一组。</li>
<li>GROUP BY子句必须出现在WHERE子句之后，ORDER BY子句之前。</li>
</ul>
<p>使用WITH ROLLUP可以汇总级别，如果是数值型的它会对它进行求和,形如：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_prods <span class="token keyword">FROM</span> products CROUP <span class="token keyword">BY</span> id <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2-过滤分组"><a href="#2-过滤分组" class="headerlink" title="2. 过滤分组"></a>2. 过滤分组</h3><p>过滤分组使用HAVING子句，HAVING非常类似于WHERE，HAVING支持所有的WHERE操作符，WHERE过滤的是指定的行而不是分组，所以HAVING比WHERE的功能跟强大。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> orders <span class="token keyword">FROM</span> products <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> id <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>过滤orders &gt;= 2的那些分组<br><strong>HAVING和WHERE的区别：</strong>WHERE在数据分组前进行过滤，HAVING在数据分组后进行过滤。这是一个重要的区别，WHERE排除的行不包括在分组中。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> id，<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> num_products <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> price <span class="token operator">>=</span> <span class="token number">10</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> id <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>先将price小于10的过滤之后，在进行分组再过滤。</p>
<h3 id="3-分组和排序"><a href="#3-分组和排序" class="headerlink" title="3.分组和排序"></a>3.分组和排序</h3><p><strong>不要忘记ORDER BY：</strong>一般在使用GROUP BY子句时，应该也给出ORDER BY子句。这是保证数据正确排序的唯一方法。千万不要仅依赖GROUP BY排序数据。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> order_num<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token operator">*</span>item_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> ordertotal <span class="token keyword">FROM</span> orderitems <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> order_num <span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token operator">*</span>item_price<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">50</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> ordertotal<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>先分组，在过滤，最后进行排序。</p>
<h3 id="4-SELECT子句顺序"><a href="#4-SELECT子句顺序" class="headerlink" title="4.SELECT子句顺序"></a>4.SELECT子句顺序</h3><table>
<thead>
<tr>
<th align="center">子句</th>
<th align="center">说明</th>
<th align="center">是否必须使用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SELECT</td>
<td align="center">要返回的列或表达式</td>
<td align="center">是</td>
</tr>
<tr>
<td align="center">FROM</td>
<td align="center">从中检索数据的表</td>
<td align="center">仅在从表选择数据时使用</td>
</tr>
<tr>
<td align="center">WHERE</td>
<td align="center">行级过滤</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">GROUP BY</td>
<td align="center">分组说明</td>
<td align="center">仅在按组计算聚集时使用</td>
</tr>
<tr>
<td align="center">HAVING</td>
<td align="center">组级过滤</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">ORDER BY</td>
<td align="center">输出排序顺序</td>
<td align="center">否</td>
</tr>
<tr>
<td align="center">LIMIT</td>
<td align="center">要检索的行数</td>
<td align="center">否</td>
</tr>
</tbody></table>
<h2 id="十二-使用子查询"><a href="#十二-使用子查询" class="headerlink" title="十二.使用子查询"></a>十二.使用子查询</h2><h3 id="1-利用子查询进行过滤"><a href="#1-利用子查询进行过滤" class="headerlink" title="1. 利用子查询进行过滤"></a>1. 利用子查询进行过滤</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> cust_id <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> order_num <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>子查询总是从内向外处理，在处理上面SELECT语句时，MYSQL实际上执行了两个操作。<br>首先，先执行：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> order_name <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此查询返回两个订单号20005和20007；再执行：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> cust_id <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> order_num <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">20005</span><span class="token punctuation">,</span><span class="token number">20007</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2-作为计算字段使用子查询"><a href="#2-作为计算字段使用子查询" class="headerlink" title="2. 作为计算字段使用子查询"></a>2. 作为计算字段使用子查询</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span>cust_state<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> orders <span class="token keyword">WHERE</span> orders<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> orders 
<span class="token keyword">FROM</span> customers <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cust_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><font color="red">注意：此时的AS的使用位置。但两张表的某个字段名相同时，进行比较时要使用完全限定列名以保证查询正确性。</font></p>
<h2 id="十三-联结表"><a href="#十三-联结表" class="headerlink" title="十三.联结表"></a>十三.联结表</h2><h3 id="1-创建联结"><a href="#1-创建联结" class="headerlink" title="1. 创建联结"></a>1. 创建联结</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> vendors<span class="token punctuation">,</span> products <span class="token keyword">WHERE</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> products<span class="token punctuation">.</span>vend_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>vend_name字段属于vendors表，而prod_name和prod_price字段属于products表。因此FROM也是从两张表中取数据。这两个表用WHERE子句联结，因为两个表的vend_id列名相同，因此使用完全限定列名。</p>
<h3 id="2-内部联结"><a href="#2-内部联结" class="headerlink" title="2. 内部联结"></a>2. 内部联结</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> vend_name<span class="token punctuation">,</span> prod_name<span class="token punctuation">,</span>prod_price <span class="token keyword">FROM</span> vendors <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> products <span class="token keyword">ON</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> products<span class="token punctuation">.</span>vend_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这种语法与上面的语法功能一致。</p>
<h3 id="3-联结多个表"><a href="#3-联结多个表" class="headerlink" title="3. 联结多个表"></a>3. 联结多个表</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> prod_name<span class="token punctuation">,</span> vend_name<span class="token punctuation">,</span> prod_price<span class="token punctuation">,</span> quantity <span class="token keyword">FROM</span> orderitems<span class="token punctuation">,</span> products<span class="token punctuation">,</span> vendors <span class="token keyword">WHERE</span> products<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> vendors<span class="token punctuation">.</span>vend_id <span class="token operator">AND</span> orderitems<span class="token punctuation">.</span>prod_id <span class="token operator">=</span> products<span class="token punctuation">.</span>prod_id <span class="token operator">AND</span> order_num <span class="token operator">=</span> <span class="token number">20005</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这里联结了三张表，还可以联结更多的表，但是会影响性能。</p>
<h2 id="十四-创建高级联结"><a href="#十四-创建高级联结" class="headerlink" title="十四.创建高级联结"></a>十四.创建高级联结</h2><h3 id="1-自联结"><a href="#1-自联结" class="headerlink" title="1. 自联结"></a>1. 自联结</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> p1<span class="token punctuation">.</span>prod_id<span class="token punctuation">,</span> p1_prod_name <span class="token keyword">FROM</span> products <span class="token keyword">AS</span> p1<span class="token punctuation">,</span> products <span class="token keyword">AS</span> p2 <span class="token keyword">WHERE</span> p1<span class="token punctuation">.</span>vend_id <span class="token operator">=</span> p2<span class="token punctuation">.</span>vend_id <span class="token operator">AND</span> p2<span class="token punctuation">.</span>prod_id <span class="token operator">=</span> <span class="token string">'DTNTR'</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>由于是使用的两个相同的表，因此必须要使用表别名，否则会产生歧义。尽量使用自联结而不是子查询，有时候自联结远比处理子查询快得多。</p>
<h3 id="2-自然联结"><a href="#2-自然联结" class="headerlink" title="2. 自然联结"></a>2. 自然联结</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token number">c</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span>order_name<span class="token punctuation">,</span> o<span class="token punctuation">.</span>order_date<span class="token punctuation">,</span> oi<span class="token punctuation">.</span>prod_id<span class="token punctuation">,</span> oi<span class="token punctuation">.</span>quantity<span class="token punctuation">,</span> oi<span class="token punctuation">.</span>item_price <span class="token keyword">FROM</span> customers <span class="token keyword">AS</span> <span class="token number">c</span><span class="token punctuation">,</span> orders <span class="token keyword">AS</span> o<span class="token punctuation">,</span> orderitems <span class="token keyword">AS</span> oi <span class="token keyword">WHERE</span> <span class="token number">c</span><span class="token punctuation">.</span>cust_id <span class="token operator">=</span> o<span class="token punctuation">.</span>cust_id <span class="token operator">AND</span> oi<span class="token punctuation">.</span>order_num <span class="token operator">=</span> o<span class="token punctuation">.</span>order_num <span class="token operator">AND</span> prod_id <span class="token operator">=</span> <span class="token string">'FB'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>自然连接排除多次出现，使每个列只返回一次。</p>
<h3 id="3-外部联结"><a href="#3-外部联结" class="headerlink" title="3. 外部联结"></a>3. 外部联结</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> orders<span class="token punctuation">.</span>order_num <span class="token keyword">FROM</span> customers <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> orders <span class="token keyword">ON</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>联结左表中的所有行，也就是customers表，没有数据的为NULL。</p>
<h3 id="4-使用带聚集函数的联结"><a href="#4-使用带聚集函数的联结" class="headerlink" title="4. 使用带聚集函数的联结"></a>4. 使用带聚集函数的联结</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> customers<span class="token punctuation">.</span>cust_name<span class="token punctuation">,</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>orders<span class="token punctuation">.</span>order_num<span class="token punctuation">)</span> <span class="token keyword">AS</span> num_ord <span class="token keyword">FROM</span> customers <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> orders <span class="token keyword">ON</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> customers<span class="token punctuation">.</span>cust_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>聚集函数也可以和联结一起使用。</p>
<h2 id="十五-组合查询"><a href="#十五-组合查询" class="headerlink" title="十五.组合查询"></a>十五.组合查询</h2><h3 id="1-使用UNION"><a href="#1-使用UNION" class="headerlink" title="1. 使用UNION"></a>1. 使用UNION</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此语句与下面语句表达意思一样：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token operator">OR</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>UNION可以联结多条SELECT语句。</p>
<h3 id="2-UNION使用规则"><a href="#2-UNION使用规则" class="headerlink" title="2. UNION使用规则"></a>2. UNION使用规则</h3><ul>
<li>UNION必须由两条或两条以上的SELECT语句组成，语句之间用关键字UNION分隔。</li>
<li>UNION中的每个查询必须包含相同的列、表达式或聚集函数，可以应用不同的表。</li>
<li>列数据类型兼容：类型不必完全相同，但必须是DBMS可以隐含地转换的类型。（例如：不同的数值类型或不同的日期类型）。</li>
</ul>
<h3 id="3-包含或取消重复的行"><a href="#3-包含或取消重复的行" class="headerlink" title="3. 包含或取消重复的行"></a>3. 包含或取消重复的行</h3><p>默认UNION是会取消掉重复的行，但是如果需要包含所有行，则可以使用UNION ALL而不是UNION。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span> <span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-对组合查询结果排序"><a href="#4-对组合查询结果排序" class="headerlink" title="4. 对组合查询结果排序"></a>4. 对组合查询结果排序</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> prod_price <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token keyword">UNION</span> <span class="token keyword">SELECT</span> vend_id<span class="token punctuation">,</span> prod_id<span class="token punctuation">,</span> prod_price <span class="token keyword">FROM</span> products <span class="token keyword">WHERE</span> vend_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">)</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_id<span class="token punctuation">,</span> prod_price<span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在用UNION组合查询时，只能使用一条ORDER BY子句，它必须出现在最后一条SELECT语句之后。</p>
<h2 id="十六-全文本搜索"><a href="#十六-全文本搜索" class="headerlink" title="十六.全文本搜索"></a>十六.全文本搜索</h2><h3 id="1-启用全文本搜索支持"><a href="#1-启用全文本搜索支持" class="headerlink" title="1. 启用全文本搜索支持"></a>1. 启用全文本搜索支持</h3><ul>
<li>MYISAM引擎支持全文本搜索，而InnoDB引擎不支持。</li>
<li>要使用FULLTEXT()索引单个列或多个列。</li>
</ul>
<h3 id="2-进行全文本搜索"><a href="#2-进行全文本搜索" class="headerlink" title="2. 进行全文本搜索"></a>2. 进行全文本搜索</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">MATCH</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> AGAINST<span class="token punctuation">(</span><span class="token string">'rabbit'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>搜索note_text列中含有rabbit的行。<br>Match()指定被搜索的列，Against()指定要使用的搜索表达式。<br>默认是按照指定的字符串在行中出现的先后排序，出现的在前则等级就高，出现在后则等级低，等级高的排在等级低的后面。</p>
<ul>
<li><b>使用完整的Match()说明：</b>传递给Match()的值与FULLTEXT()定义中的相同，如果指定多个列，则必须列出它们。</li>
<li><b>搜索不区分大小写：</b>除非使用BINARY方式，否则全文本搜索不区分大小写。</li>
<li><b>排序多个搜索项：</b>如果指定多个搜索项，则包含多数匹配词的那些行具有比包含较少词的那些行高的等级值。</li>
</ul>
<h3 id="3-使用查询扩展"><a href="#3-使用查询扩展" class="headerlink" title="3. 使用查询扩展"></a>3. 使用查询扩展</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'anvils'</span> <span class="token keyword">WITH</span> QUERY EXPANSION<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>它不仅会返回含有anvis的行，还会返回包含与含有anvois行中某些单词一样的行，即使这些行中不包含anvis。</p>
<h3 id="4-布尔文本搜索"><a href="#4-布尔文本搜索" class="headerlink" title="4. 布尔文本搜索"></a>4. 布尔文本搜索</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'heavy'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将搜索note_text列中含有heavy的行。<br><font color="red">即使没有FULLTEXT索引也可以使用。</font></p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'heavy -rope*'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>匹配含有heavy词但是不包含以rope开始的词的行。</p>
<table>
<thead>
<tr>
<th align="center">布尔操作符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">+</td>
<td align="center">包含，词必须存在</td>
</tr>
<tr>
<td align="center">-</td>
<td align="center">排除，词必须不出现</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="center">包含，而且增加等级值</td>
</tr>
<tr>
<td align="center">&lt;</td>
<td align="center">包含，且减少等级值</td>
</tr>
<tr>
<td align="center">()</td>
<td align="center">把词组成子表达式</td>
</tr>
<tr>
<td align="center">~</td>
<td align="center">取消一个词的排序值</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">词尾的通配符</td>
</tr>
<tr>
<td align="center">“”</td>
<td align="center">定义一个短语(与单个词的列表不一样，它匹配整个短语以便包含或排除这个短语)</td>
</tr>
</tbody></table>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'+rabbit +bait'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个搜索匹配包含词rabbit和bait的行。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'rabbit bait'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>没有指定操作符，这个搜索匹配包含rabbit和bait中的至少一个词的行。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'"rabbit bait"'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个搜索匹配短语rabbit bait而不是匹配两个词rabbit和bait。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'>rabbit &lt; carrot'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>匹配rabbit和carrot，增加前者的等级, 降低后者的等级。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> note_text <span class="token keyword">FROM</span> productnotes <span class="token keyword">WHERE</span> <span class="token keyword">Match</span><span class="token punctuation">(</span>note_text<span class="token punctuation">)</span> Against<span class="token punctuation">(</span><span class="token string">'+safe +(&lt; combination>)'</span> <span class="token operator">IN</span> <span class="token keyword">BOOLEAN</span> MODE<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个搜索匹配词safe和combintion, 降低后者的等级。<br><font color="red">在布尔方式中，排列而不排序。</font></p>
<h3 id="5-全文本的使用说明"><a href="#5-全文本的使用说明" class="headerlink" title="5. 全文本的使用说明"></a>5. 全文本的使用说明</h3><ul>
<li>在索引全文本数据时，短词被忽略且从索引中排除。短词定义为那些具有3个或3个以下字符的词(如果需要，这个数目可以更改)。</li>
<li>MySQL带有一个内建的非用词列表，这些词在索引全文本数据时总是被忽略，如果需要，可以覆盖这个列表。</li>
<li>许多词出现的频率很高，搜索它们没有用处。因此，MySQL规定了一条50%规则。如果一个词出现在50%以上，则将它作为一个非用词忽略。50%规则不用与IN BOOLEAN MODE。</li>
<li>如果表中的行数少于3行，则全文本搜索不返回结果(因为每个行或者不出现，或者至少出现在50%的行中)。</li>
<li>忽略词中的单引号。例如don’t索引为dont。</li>
<li>不具有词的分隔符（包括日语和汉语）的语言不能恰当地返回全文本搜索结果。</li>
<li>MyISAM数据库引擎中支持全文本搜索。</li>
</ul>
<h2 id="十七-插入数据"><a href="#十七-插入数据" class="headerlink" title="十七. 插入数据"></a>十七. 插入数据</h2><h3 id="1-插入完整的行"><a href="#1-插入完整的行" class="headerlink" title="1. 插入完整的行"></a>1. 插入完整的行</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token string">'Pep E. LaPew'</span><span class="token punctuation">,</span>
<span class="token string">'100 Main Street'</span><span class="token punctuation">,</span>
<span class="token string">'Los Angles'</span><span class="token punctuation">,</span>
<span class="token string">'CA'</span><span class="token punctuation">,</span>
<span class="token string">'90046'</span><span class="token punctuation">,</span>
<span class="token string">'USA'</span><span class="token punctuation">,</span>
<span class="token string">'NULL'</span><span class="token punctuation">,</span>
<span class="token string">'NULL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>INSERT语句一般不会产生输出</strong>，这种语句虽然简单，但是并不安全，过度依赖于表中列的顺序，不推荐使用。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> cust_email<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>Pep E<span class="token punctuation">.</span> LaPew<span class="token string">',
'</span><span class="token number">100</span> Main Street<span class="token string">',
'</span>Los Angles<span class="token string">',
'</span>CA<span class="token string">',
'</span><span class="token number">90046</span><span class="token string">',
'</span>USA<span class="token string">',
'</span><span class="token boolean">NULL</span><span class="token string">',
'</span><span class="token boolean">NULL</span>'<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以为指定了列名，VALUES必须以其指定的次序匹配指定的列名，不一定按各个列出现在实际表中的次序。<br><b>提高整体性能：</b>如果SELECT语句更重要，则可以使用INSERT LOW_PRIORITY INTO降低INSERT语句的优先级。</p>
<h3 id="2-插入多个行"><a href="#2-插入多个行" class="headerlink" title="2. 插入多个行"></a>2. 插入多个行</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customer<span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'Pep E. LaPew'</span><span class="token punctuation">,</span> <span class="token string">'100 Main Street'</span><span class="token punctuation">,</span> <span class="token string">'Los Angles'</span><span class="token punctuation">,</span> <span class="token string">'CA'</span><span class="token punctuation">,</span> <span class="token string">'90046'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customer<span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'M. Martian'</span><span class="token punctuation">,</span> <span class="token string">'42 Galaxy Way'</span><span class="token punctuation">,</span> <span class="token string">'New York'</span><span class="token punctuation">,</span> <span class="token string">'NY'</span><span class="token punctuation">,</span> <span class="token string">'11213'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或者</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customer<span class="token punctuation">(</span>cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'Pep E. LaPew'</span><span class="token punctuation">,</span> <span class="token string">'100 Main Street'</span><span class="token punctuation">,</span> <span class="token string">'Los Angles'</span><span class="token punctuation">,</span> <span class="token string">'CA'</span><span class="token punctuation">,</span> <span class="token string">'90046'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'M. Martian'</span><span class="token punctuation">,</span> <span class="token string">'42 Galaxy Way'</span><span class="token punctuation">,</span> <span class="token string">'New York'</span><span class="token punctuation">,</span> <span class="token string">'NY'</span><span class="token punctuation">,</span> <span class="token string">'11213'</span><span class="token punctuation">,</span> <span class="token string">'USA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>第二种会提高INSERT的性能。</p>
<h3 id="3-插入检索出的数据"><a href="#3-插入检索出的数据" class="headerlink" title="3. 插入检索出的数据"></a>3. 插入检索出的数据</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> customers<span class="token punctuation">(</span>cust_id<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> cust_email<span class="token punctuation">,</span> cust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country<span class="token punctuation">)</span> <span class="token keyword">SELECT</span> cust_id<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> cust_email<span class="token punctuation">,</span> ccust_name<span class="token punctuation">,</span> cust_address<span class="token punctuation">,</span> cust_city<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_state<span class="token punctuation">,</span> cust_zip<span class="token punctuation">,</span> cust_country <span class="token keyword">FROM</span> custnew<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将custnew中的所有数据导入customers，MySQL不关心SELECT返回的列名，它使用的是列的位置，SELECT中的第一列将用来填充表列中的第一列，以此类推。</p>
<h2 id="十八-更新和删除数据"><a href="#十八-更新和删除数据" class="headerlink" title="十八.更新和删除数据"></a>十八.更新和删除数据</h2><h3 id="1-更新数据"><a href="#1-更新数据" class="headerlink" title="1. 更新数据"></a>1. 更新数据</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">UPDATE</span> customers <span class="token keyword">SET</span> cust_email <span class="token operator">=</span> <span class="token string">'elmer@fudd.com'</span><span class="token punctuation">,</span> cust_name <span class="token operator">=</span> <span class="token string">'The Fudds'</span> <span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">10005</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>UPDATE语句总是以要更新的表的名字开始，SET命令用来将新值赋给被更新的列，如果不使用WHERE子句将更新表中的所有列。<br><strong>IGNORE关键字：</strong>如果用UPDATE语句更新时出现错误，则整个UPDATE操作被取消，错误发生前更新的所有行被恢复到它们原来的值。为即使发生错误，也继续进行更新，可使用IGNORE关键字，UPDATE IGNORE customers…</p>
<h3 id="2-删除数据"><a href="#2-删除数据" class="headerlink" title="2. 删除数据"></a>2. 删除数据</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> cust_id <span class="token operator">=</span> <span class="token number">10006</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>删除customers表中cust_id = 10006这一行。<br>DELETE删除整行而不是整列。<br><strong>更快的删除：</strong>如果想从表中删除所有行，不要使用DELETE, 可使用TRUNCATE TABLE语句，它完成相同的工作，单速度更快。</p>
<h3 id="3-更新和删除的指导原则"><a href="#3-更新和删除的指导原则" class="headerlink" title="3. 更新和删除的指导原则"></a>3. 更新和删除的指导原则</h3><p>下面是UPDATE或DELETE时所遵循的习惯：</p>
<ul>
<li>除非确实打算更新和删除每一行，否则绝对不要使用不带WHERE子句的UPDATE或DELETE语句。</li>
<li>保证每个表都有主键。</li>
<li>在对UPDATE或DELETE语句使用WHERE子句前，应该先用SELECT进行测试，保证它过滤的是正确的记录，以防编写的WHERE子句不正确。</li>
<li>使用强制实施引用完整性的数据库，这样MySQL将不允许删除具有与其他表相关联的数据的行。<br><strong>小心使用：</strong>MySQL没有撤销按钮，应该非常小心地使用UPDATE和DELETE。</li>
</ul>
<h2 id="十九-创建和操纵表"><a href="#十九-创建和操纵表" class="headerlink" title="十九.创建和操纵表"></a>十九.创建和操纵表</h2><h3 id="1-创建表"><a href="#1-创建表" class="headerlink" title="1. 创建表"></a>1. 创建表</h3><pre class="line-numbers language-sql"><code class="language-sql"> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customers <span class="token punctuation">(</span>
    cust_id <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    cust_name char<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cust_address char<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cust_city char<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cust_state char<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cust_zip char<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cust_country char<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cust_contact char<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cust_email char<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>cust_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>cust_id为主键名，且为自增的。如果仅想在一个表不存在时创建它，应该在表名后给出IF NOT EXISTS。仅在表名不存在时创建它。<br><strong>主键和NULL值：</strong>主键为其值唯一标识表中每个行的列。主键中只能使用不允许NULL值得列。允许NULL值的列不能作为作为唯一标识。<br>每个表只允许一个AUTO_INCREMENT列，而且它必须被索引（如，通过使它成为主键）。<br><strong>确定AUTO_INCREMENT值：</strong>可以使用last_insert_id()函数获得最后一个AUTO_INCREMENT的值，如：SELECT last_insert_id()</p>
<h3 id="2-指定默认值"><a href="#2-指定默认值" class="headerlink" title="2. 指定默认值"></a>2. 指定默认值</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orderitems
<span class="token punctuation">(</span>
    order_num <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    order_item <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    prod_id char<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    quantity <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">,</span>
    item_price <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>order_num<span class="token punctuation">,</span> order_item<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>给quantity列包含默认值1，在未给出数量的情况下使用数量1。DEFAULT不允许使用函数，只支持常量。</p>
<h3 id="3-引擎类型"><a href="#3-引擎类型" class="headerlink" title="3. 引擎类型"></a>3. 引擎类型</h3><ul>
<li>InnoDB是一个可靠的事务处理引擎，它不支持全文搜索。</li>
<li>MEMORY在功能等同于MyISM，但由于数据存储在内存(不是磁盘)中，速度很快（特别适合于临时表）。</li>
<li>MyISAM是一个性能极高的引擎，它支持全文本搜索，但不支持事务处理。<br><font color="red">注意：外键不能跨引擎</font></li>
</ul>
<h3 id="3-更新表"><a href="#3-更新表" class="headerlink" title="3.更新表"></a>3.更新表</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> vendors <span class="token keyword">ADD</span> vend_phone CHAR<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这条语句给vendors表增加一个名为vend_phone的列，必须明确其数据类型。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> vendors <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> vend_phone<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>用于删除vendors表中vend_phone的列。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> orderitems <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> fk_orderitems_orders <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>order_num<span class="token punctuation">)</span>
<span class="token keyword">REFERENCES</span> orders <span class="token punctuation">(</span>order_num<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>给orderitems表中order_num设置成外键对应orders表中的order_num, 该外键的名称为fk_orderitems_orders，方便以后删除外键。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> orderitems <span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> fk_orderitems_orders<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>删除orderitems表与orders表的外键约束。</p>
<h3 id="4-删除表"><a href="#4-删除表" class="headerlink" title="4. 删除表"></a>4. 删除表</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> customers2<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>删除customers2这张表。</p>
<h3 id="5-重命名表"><a href="#5-重命名表" class="headerlink" title="5. 重命名表"></a>5. 重命名表</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> customers2 <span class="token keyword">TO</span> customers<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将customers2表的名字重命名为customers。</p>
<h2 id="二十-使用视图"><a href="#二十-使用视图" class="headerlink" title="二十.使用视图"></a>二十.使用视图</h2><h3 id="1-为什么使用视图"><a href="#1-为什么使用视图" class="headerlink" title="1. 为什么使用视图"></a>1. 为什么使用视图</h3><p><strong>视图</strong>：它不包含表中应该有任何列或数据，它包含的是一个SQL查询。</p>
<ul>
<li>重用SQL</li>
<li>简化复杂的SQL操作。在编写查询时，可以方便地重用它而不去知道它的基本查询细节</li>
<li>使用表的组成部分而不是整个表</li>
<li>保护数据。可以给用户授予表的特定部分的访问权限而不是整个表的访问权限</li>
<li>更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据</li>
</ul>
<h3 id="2-视图的规则和限制"><a href="#2-视图的规则和限制" class="headerlink" title="2. 视图的规则和限制"></a>2. 视图的规则和限制</h3><ul>
<li>与表一样，视图必须唯一命名(不能给视图取与别的视图或表相同的名字)。</li>
<li>对于可以创建的视图数目没有限制。</li>
<li>为了创建你视图，必须具有足够的访问权限。这些限制通常由数据库管理人员授予。</li>
<li>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构造一个视图。</li>
<li>ORDER BY可以用在视图中，但如果从视图检索数据SELECT中也含有ORDER BY, 那么该视图中的ORDER BY<br>将被覆盖。</li>
<li>视图不能索引，也不能有关联的触发器或默认值。</li>
<li>视图可以和表其使用。</li>
</ul>
<h3 id="3-使用视图"><a href="#3-使用视图" class="headerlink" title="3. 使用视图"></a>3. 使用视图</h3><ul>
<li>视图使用CREATE VIEW语句创建。</li>
<li>使用SHOW CREATE VIEW viewname; 来查看创建视图的语句。</li>
<li>用DROP删除视图，其语法为DROP VIEW viewname;。</li>
<li>更新视图时，可以先用DROP再用CREATE, 也可以直接用CREATE OR REPLACE VIEW。如果要更新的视图不存在，则第2条更新语句会创建一个视图；如果要更新的视图存在，则第2条更新语句会替换原有视图。</li>
</ul>
<h3 id="4-代码演示"><a href="#4-代码演示" class="headerlink" title="4. 代码演示"></a>4. 代码演示</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> productcustomers <span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact<span class="token punctuation">,</span> prod_id 
<span class="token keyword">FROM</span> customers<span class="token punctuation">,</span> orders<span class="token punctuation">,</span> orderitems 
<span class="token keyword">WHERE</span> customers<span class="token punctuation">.</span>cust_id <span class="token operator">=</span> orders<span class="token punctuation">.</span>cust_id 
  <span class="token operator">AND</span> orderitems<span class="token punctuation">.</span>order_num <span class="token operator">=</span> orders<span class="token punctuation">.</span>order_num<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>创建一个名为productcustomers的视图。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> cust_name<span class="token punctuation">,</span> cust_contact
<span class="token keyword">FROM</span> productcustomers
<span class="token keyword">WHERE</span> prod_id <span class="token operator">=</span> <span class="token string">'TNT2'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>从视图中检索特定数据，极大地简化了复杂SQL语句的使用。利用视图，可一次性编写基础的SQL, 然后根据需要多次使用。</p>
<hr>

<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vendorlocation <span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> Concat<span class="token punctuation">(</span>RTrim<span class="token punctuation">(</span>vend_name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'('</span><span class="token punctuation">,</span>RTrim<span class="token punctuation">(</span>vend_country<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">)</span>
       <span class="token keyword">AS</span> vend_title
<span class="token keyword">FROM</span> vendors
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> vend_name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这条语句创建vendorlocation视图</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vendorlocations<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="5-更新视图"><a href="#5-更新视图" class="headerlink" title="5.更新视图"></a>5.更新视图</h3><p>视图是可更新的，但是并非所有视图都是可更新的。<br>以下操作不能进行视图的更新：</p>
<ul>
<li>分组（使用GROUP BY和HAVING）</li>
<li>联结</li>
<li>子查询</li>
<li>并</li>
<li>聚集函数</li>
<li>DISTINCT</li>
<li>导出（计算）列</li>
</ul>
<p><strong>将视图用于检索：</strong>一般，应该将视图用于检索而不用于更新。</p>
<h2 id="二十一-使用存储过程"><a href="#二十一-使用存储过程" class="headerlink" title="二十一. 使用存储过程"></a>二十一. 使用存储过程</h2><h3 id="1-为什么要使用存储过程"><a href="#1-为什么要使用存储过程" class="headerlink" title="1. 为什么要使用存储过程"></a>1. 为什么要使用存储过程</h3><p><strong>存储过程</strong>：简单来说就是为以后的使用而保存的一条或多条MySQL语句的集合。</p>
<ul>
<li>通过把处理封装在容易使用的单元中，简化复杂的操作。</li>
<li>由于不要求反复建立一系列处理步骤，这保证了数据的完整性。防止错误的发生。</li>
<li>简化对变动的管理。</li>
<li>提高性能。因为使用存储过程比使用单独的SQL语句要快。</li>
</ul>
<h3 id="2-使用存储过程"><a href="#2-使用存储过程" class="headerlink" title="2. 使用存储过程"></a>2. 使用存储过程</h3><h4 id="2-1-创建存储过程"><a href="#2-1-创建存储过程" class="headerlink" title="2.1 创建存储过程"></a>2.1 创建存储过程</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> priceaverage
    <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>CEATE PROCEDURE是创建存储过程的语法格式。BEGIN和END语句用来限定存储过程体。</p>
<p><font color="red">mysql命令行客户机的分隔符：</font>mysql命令行实用程序使用;作为语句分隔符。如果命令行实用程序要解释存储过程自身内的;字符，则它们最终不会成为存储过程的成分，这会使存储过程中的SQL出现语句错误。解决方法是临时更改命令行实用程序的语句分隔符，如下：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">DELIMITER</span> <span class="token comment" spellcheck="true">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span> <span class="token keyword">AS</span> priceaverage
    <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token comment" spellcheck="true">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其中DELIMITER //告诉命令行实用程序//作为新的语句分隔符，可以看到END//最后变了，最后又恢复分隔符为;字符。 </p>
<h4 id="2-2-执行存储过程"><a href="#2-2-执行存储过程" class="headerlink" title="2.2 执行存储过程"></a>2.2 执行存储过程</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CALL</span> productpricing<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>执行更改刚刚创建的存储过程并显示返回结果。</p>
<h4 id="2-3-删除存储过程"><a href="#2-3-删除存储过程" class="headerlink" title="2.3 删除存储过程"></a>2.3 删除存储过程</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> productpricing<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>删除刚刚创建的存储过程。<br><strong>仅当存在时删除</strong>: <code>DROP PROCEDURE IF EXISTS;</code> </p>
<h4 id="2-4-使用参数"><a href="#2-4-使用参数" class="headerlink" title="2.4 使用参数"></a>2.4 使用参数</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> producpricing<span class="token punctuation">(</span>
    <span class="token keyword">OUT</span> pl <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">OUT</span> ph <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">OUT</span> pa <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">SELECT</span> <span class="token function">Min</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span>
    <span class="token keyword">INTO</span> pl
    <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
    <span class="token keyword">SELECT</span> <span class="token function">Max</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span>
    <span class="token keyword">INTO</span> ph
    <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
    <span class="token keyword">SELECT</span> <span class="token function">Avg</span><span class="token punctuation">(</span>prod_price<span class="token punctuation">)</span>
    <span class="token keyword">INTO</span> pa
    <span class="token keyword">FROM</span> products<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此过程接受3个参数，pl最低价格，ph最高价格，pa平均价格。关键字OUT指出相应的参数用来从存储过程传出一个值（返回给调用者）。MySQL支持IN（传递给存储过程，也就是需要传入一个值）,OUT(从存储过程传出，也就是该值已被算出，到时只需要调用即可)和INOUT（对存储过程传入和传出）。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CALL</span> producpricing<span class="token punctuation">(</span><span class="token variable">@pricelow</span><span class="token punctuation">,</span>
                   <span class="token variable">@pricehigh</span><span class="token punctuation">,</span>
                   <span class="token variable">@priceverage</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>要求传递3个参数，因此必须正好传递3个参数。<strong>所有MySQL变量都必须以@开始。</strong></p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token variable">@pricelow</span><span class="token punctuation">,</span> <span class="token variable">@pricehigh</span><span class="token punctuation">,</span> <span class="token variable">@priceverage</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>以后就可以直接使用SELECT语句返回值。</p>
<h3 id="3-建立智能存储过程"><a href="#3-建立智能存储过程" class="headerlink" title="3. 建立智能存储过程"></a>3. 建立智能存储过程</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">-- Name: ordertotal</span>
<span class="token comment" spellcheck="true">-- Parameters: onumber = order number</span>
<span class="token comment" spellcheck="true">--             taxable = 0 if not taxable, 1 if taxable</span>
<span class="token comment" spellcheck="true">--             ototal = order total variable</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">(</span>
    <span class="token operator">IN</span> onumber <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token operator">IN</span> taxable <span class="token keyword">BOOLEAN</span><span class="token punctuation">,</span>
    <span class="token keyword">OUT</span> ototal <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">'Obtain order total, optionally adding tax'</span>
<span class="token keyword">BEGIN</span> 
    <span class="token comment" spellcheck="true">-- Declare variable for total</span>
    <span class="token keyword">DECLARE</span> total <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">-- Declare tax precentage</span>
    <span class="token keyword">DECLARE</span> taxrate <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">6</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- Get the order total</span>
    <span class="token keyword">SELECT</span> <span class="token function">Sum</span><span class="token punctuation">(</span>item_price<span class="token operator">*</span>quantity<span class="token punctuation">)</span>
    <span class="token keyword">FROM</span> orderitems
    <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> onumber
    <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- Is this taxable?</span>
    <span class="token keyword">IF</span> taxable <span class="token keyword">THEN</span>
       <span class="token comment" spellcheck="true">-- Yes, so add taxrate to the total</span>
       <span class="token keyword">SELECT</span> total<span class="token operator">+</span><span class="token punctuation">(</span>total<span class="token operator">/</span><span class="token number">100</span><span class="token operator">*</span>taxrate<span class="token punctuation">)</span> <span class="token keyword">INTO</span> total<span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- And Finally, save to out variable</span>
    <span class="token keyword">SELECT</span> total <span class="token keyword">INTO</span> ototal<span class="token punctuation">;</span>

<span class="token keyword">END</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>增加了注释（前面放置–），用DECLARE语句定义了两个局部变量。最后将将局部变量total保存到ototal中<br>COMMENT关键字：它不是必需的，但如果给出，将在<code>SHOW PROCEDURE STATUS</code>的结果中显示。<br><strong>执行：</strong></p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CALL</span> ordertotal<span class="token punctuation">(</span><span class="token number">20005</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">@total</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@total</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="4-检查存储过程"><a href="#4-检查存储过程" class="headerlink" title="4. 检查存储过程"></a>4. 检查存储过程</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> ordertotal<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>显示用来创建一个存储过程的CREATE语句。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'ordertotal'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>获得包括何时、由谁创建等详细信息的存储过程列表，也可以指定一个LIKE进行过滤。</p>
<h2 id="二十二-使用游标"><a href="#二十二-使用游标" class="headerlink" title="二十二.使用游标"></a>二十二.使用游标</h2><h3 id="1-使用游标"><a href="#1-使用游标" class="headerlink" title="1. 使用游标"></a>1. 使用游标</h3><p>有时需要在检索出来的行中前进或后退一行或多行。这就是使用游标的原因。<font color="red">MySQL游标只能用于存储过程。</font><br>使用游标涉及几个明确的步骤：</p>
<ul>
<li>在能够使用游标前， 必须声明（定义）它。这个过程实际上没有检索数据，它只是定义要使用的SELECT语句。</li>
<li>一旦声明后，必须打开游标以供使用。这个过程用前面定义的SELECT语句把数据实际检索出来。</li>
<li>对于填有数据的游标，根据需要取出（检索）各行。</li>
<li>在结束游标使用时，必须关闭游标。</li>
</ul>
<h3 id="2-创建游标"><a href="#2-创建游标" class="headerlink" title="2. 创建游标"></a>2. 创建游标</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> processorders<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token comment" spellcheck="true">-- Declare the cursor</span>
    <span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span> 
    <span class="token keyword">FOR</span>
    <span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- Open the cursor</span>
    <span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- Close the cursor</span>
    <span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个存储过程声明、打开和关闭一个游标。但对检索出的数据什么也没做。</p>
<h3 id="3-使用游标检索数据"><a href="#3-使用游标检索数据" class="headerlink" title="3. 使用游标检索数据"></a>3. 使用游标检索数据</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> processorders<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
    <span class="token comment" spellcheck="true">-- Declare local variables</span>
    <span class="token keyword">DECLARE</span> done <span class="token keyword">BOOLEAN</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">DECLARE</span> o <span class="token keyword">INT</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- Declare the cursor</span>
    <span class="token keyword">DECLARE</span> ordernumbers <span class="token keyword">CURSOR</span> 
    <span class="token keyword">FOR</span>
    <span class="token keyword">SELECT</span> order_num <span class="token keyword">FROM</span> orders<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">-- Declare continue handler</span>
    <span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'02000'</span> <span class="token keyword">SET</span> done<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- Open the cursor</span>
    <span class="token keyword">OPEN</span> ordernumbers<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- Loop through all rows</span>
    REPEAT
        <span class="token comment" spellcheck="true">-- Get order number</span>
        <span class="token keyword">FETCH</span> ordernumbers <span class="token keyword">INTO</span> o<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- END of loop</span>
    UNTIL done <span class="token keyword">END</span> REPEAT<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">-- Close the cursor</span>
    <span class="token keyword">CLOSE</span> ordernumbers<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>循环检索数据，使用FETCH检索当前order_num到声明的名为o的变量中。这个中的FETCH是在REPEAT内，因此它反复执行直到done为真（由UNIT done END REPEAT;规定）。为使它起作用，用一个DEFAULT 0（假，不结束）定义变量done。<code>DECLARE CONTINUE HANDLER FOR SQLSTATE &#39;02000&#39; SET done=1;</code>这条语句定义一个CONTINUE HANDLER, 它是在条件出现时被执行的代码。这里，它指出当SQLSTATE’02000’出现时，SET done=1。SQLSTATE ‘02000是一个未找到条件，当REPATE由于没有更多的行供循环而不能继续时，出现这个条件。</p>
<h2 id="二十三-使用触发器"><a href="#二十三-使用触发器" class="headerlink" title="二十三.使用触发器"></a>二十三.使用触发器</h2><h3 id="1-创建触发器"><a href="#1-创建触发器" class="headerlink" title="1. 创建触发器"></a>1. 创建触发器</h3><p><strong>触发器</strong>：需要在某个表发生更改是自动处理。<br>创建触发器时，需要给出4条信息：</p>
<ul>
<li>唯一的触发器名</li>
<li>触发器关联的表</li>
<li>触发器应该响应的活动（DELETE、INSERT或UPDATE）</li>
<li>触发器何时执行（处理之前BEFORE或之后ALTER）<br><font color="red">保证每个数据库的触发器名唯一：</font>触发器名在每个表中唯一，但不是在数据库中唯一，这表示同一数据库中的两个表可具有相同名字的触发器。<br><font color="red">只有表才支持触发器，视图不支持(临时表也不支持)。</font></li>
</ul>
<h3 id="2-删除触发器"><a href="#2-删除触发器" class="headerlink" title="2. 删除触发器"></a>2. 删除触发器</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> newproduct<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>触发器不能更新或覆盖。为了修改一个触发器，必须先删除它，然后再重新创建。</p>
<h3 id="3-INSERT触发器"><a href="#3-INSERT触发器" class="headerlink" title="3. INSERT触发器"></a>3. INSERT触发器</h3><ul>
<li>在INSERT触发器代码中，可引用一个名为NEW的虚拟表，访问被插入的行。</li>
<li>在BEFORE INSERT触发器中，NEW中的值也可以被更新（允许更改被插入的值）。</li>
<li>对于AUTO_INCREMENT列，NEW在INSERT执行之前包含0，在INSERT执行之后包含新的自动生成值。<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> neworder <span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> orders
<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SELECT</span> NEW<span class="token punctuation">.</span>order_num<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
FOR EACH ROW对每个插入行都执行。当先orders表中插入数据时，会自动返回AUTO_INCREMENT自动增长此时的值。</li>
</ul>
<h3 id="4-DELETE触发器"><a href="#4-DELETE触发器" class="headerlink" title="4. DELETE触发器"></a>4. DELETE触发器</h3><ul>
<li>在DELETE触发器代码内，你可以引用一个名为OLD的虚拟表，访问被删除的行。</li>
<li>OLD中的值全部都是只读，不能更新。<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> deleteorder BEFORE <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> orders <span class="token keyword">FOR EACH ROW</span> 
<span class="token keyword">BEGIN</span>
  <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> archive_orders<span class="token punctuation">(</span>order_num<span class="token punctuation">,</span> order_date<span class="token punctuation">,</span> cust_id<span class="token punctuation">)</span> 
  <span class="token keyword">VALUES</span><span class="token punctuation">(</span>OLD<span class="token punctuation">.</span>order_num<span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>order_date<span class="token punctuation">,</span> OLD<span class="token punctuation">.</span>cust_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
在任意订单被删除前执行此触发器，将要被删除的订单保存在一个名为archive_orders的表中。</li>
</ul>
<p><strong>多语句触发器</strong>；使用BEGIN END块的好处是触发器能容纳多余SQL语句。</p>
<h3 id="5-UPDATE触发器"><a href="#5-UPDATE触发器" class="headerlink" title="5. UPDATE触发器"></a>5. UPDATE触发器</h3><ul>
<li>在UPDATE触发器代码中，你可以引用一个名为OLD的虚拟表访问以前（UPDATE语句前）的值，引用一个名为NEW的虚拟表访问新更新的值。</li>
<li>在BEFORE UPDATE触发器中，NEW中的值可能也被更新（允许更改将要用于UPDATE中的值）。</li>
<li>OLD中的值全部都是只读的，不能更新。<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> updatevendor BEFORE <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> vendors 
<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">SET</span> NEW<span class="token punctuation">.</span>vend_state <span class="token operator">=</span> Upper<span class="token punctuation">(</span>New<span class="token punctuation">.</span>vend_state<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
该语句会保证插入的字段vend_state全部都是大写的。</li>
</ul>
<h2 id="二十四-管理事务处理"><a href="#二十四-管理事务处理" class="headerlink" title="二十四.管理事务处理"></a>二十四.管理事务处理</h2><h3 id="1-事务处理"><a href="#1-事务处理" class="headerlink" title="1. 事务处理"></a>1. 事务处理</h3><p>MyISAM引擎不支持事务处理管理，InnoDB引擎支持事务处理管理。<br><strong>事务处理</strong>是一种机制，可以用来维护数据库的完整性，它保证成批的MySQL操作要么完全执行，要么完全不执行。<br>几个关键词：</p>
<ul>
<li><strong>事务</strong>：指一组SQL语句。</li>
<li><strong>回退</strong>：指撤销指定SQL语句的过程。</li>
<li><strong>提交</strong>：指将未存储的SQL语句结果写入数据库表</li>
<li><strong>保留点</strong>：指事务处理中设置的临时占位符，你可以对它发布回退（与回退整个事务处理不同）。</li>
</ul>
<h3 id="2-控制事务处理"><a href="#2-控制事务处理" class="headerlink" title="2. 控制事务处理"></a>2. 控制事务处理</h3><p>标识事务的开始</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="2-1-使用ROLLBACK"><a href="#2-1-使用ROLLBACK" class="headerlink" title="2.1 使用ROLLBACK"></a>2.1 使用ROLLBACK</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> FORM ordertotals<span class="token punctuation">;</span>
<span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> ordertotals<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>START TRANSACTION到ROLLBACK中的语句全部都没有生效。<br>显然，ROLLBACK只能在一个事务处理内使用（在执行一条START TRANSACTION命令之后）。<br><strong>那些语句可以回退：</strong> 事务处理用来管理INSERT、UPDATE和DELETE语句。你不能回退SELECT语句。你不能回退CREATE或DROP操作。事务处理快中可以使用这两条语句，但如果你执行回退，它们不会被撤销。</p>
<h4 id="2-2-使用COMMIT"><a href="#2-2-使用COMMIT" class="headerlink" title="2.2 使用COMMIT"></a>2.2 使用COMMIT</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span> 
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> orderitems <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20010</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token keyword">order</span> <span class="token keyword">WHERE</span> order_num <span class="token operator">=</span> <span class="token number">20010</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>一般的MySQL语句都是直接针对数据库表执行和编写的。这是隐含提交，即提交操作都是自动进行的。<br>但是，在事务处理块中，提交不会隐含地进行，使用COMMIT进行提交。最后的COMMIT语句仅在不出错时写出更改。如果第一条DELETE起作用，第二条失败，则两条DELETE都不提交。</p>
<h3 id="3-使用保留点"><a href="#3-使用保留点" class="headerlink" title="3. 使用保留点"></a>3. 使用保留点</h3><p>为了支持回退部分事务处理，必须能在事务处理块中合适位置放置占位符。这样，如果需要回退，可以回退到某个占位符。这些占位符称为保留点，使用SAVEPOINT创建站位符。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SAVEPOINT</span> delete1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>每个保留点都取标识它的唯一名字，以便回退时，MySQL知道要回退到何处。为了回退到指定的保留点，可以如下进行：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> delete1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>释放保留点</strong>：保留点在事务处理完成（ROLLBACK或COMMIT）后自动释放。MySQL5以来，也可以用RELEASE SAVEPOINT明确地释放保留点。</p>
<h3 id="4-更改默认的提交行为"><a href="#4-更改默认的提交行为" class="headerlink" title="4. 更改默认的提交行为"></a>4. 更改默认的提交行为</h3><p>默认的MySQL行为是自动提交所有更改。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>autocommit标志决定是否自动提交更改，不管有没有COMMIT语句。设置autocommit为0（假）提示MySQL不自动提交更改（知道autocommit被设置为真为止）。</p>
<h2 id="二十五-全球化和本地化"><a href="#二十五-全球化和本地化" class="headerlink" title="二十五.全球化和本地化"></a>二十五.全球化和本地化</h2><h3 id="1-字符集和校对顺序"><a href="#1-字符集和校对顺序" class="headerlink" title="1. 字符集和校对顺序"></a>1. 字符集和校对顺序</h3><ul>
<li><strong>字符集</strong>为字母和符号的集合</li>
<li><strong>编码</strong>为某个字符集成员的内部表示</li>
<li><strong>校对</strong>为规定字符如何比较的指令</li>
</ul>
<h3 id="2-使用字符集合校对顺序"><a href="#2-使用字符集合校对顺序" class="headerlink" title="2. 使用字符集合校对顺序"></a>2. 使用字符集合校对顺序</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CHARACTER SET</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这条语句显示所有可用的字符集以及每个字符集的描述和默认校对。<br>查看所支持校对的完整列表，使用以下语句：</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SHOW</span> COLLATION<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此语句显示所有可用的校对，以及它们适用的字符集。</p>
<h4 id="2-1-创建表时指定字符集和校对"><a href="#2-1-创建表时指定字符集和校对" class="headerlink" title="2.1 创建表时指定字符集和校对"></a>2.1 创建表时指定字符集和校对</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mytable<span class="token punctuation">(</span>
    column1 <span class="token keyword">INT</span><span class="token punctuation">,</span>
    column2 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">DEFAULT</span> CHARCTER <span class="token keyword">SET</span> hebrew
 <span class="token keyword">COLLATE</span> hebrew_general_ci<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此语句创建一个包含两列的表，并且指定一个字符集和一个校对顺序。</p>
<ul>
<li>如果指定CHARCTER SET和COLLATE两者，则使用这些值。</li>
<li>如果只指定CHARCTER SET，则使用此字符集及其默认的校对</li>
<li>如果既不指定CHARCTER SET, 也不指定COLLATE，则使用数据库默认。</li>
</ul>
<p>MySQL还允许<strong>对每个列设置字符集合校对，在进行排序时也可以设置。</strong><br>可以使用<strong>Cast()或Convert()函数</strong>在字符集之间进行转换。</p>
<h2 id="二十六-安全管理"><a href="#二十六-安全管理" class="headerlink" title="二十六.安全管理"></a>二十六.安全管理</h2><h3 id="1-管理用户"><a href="#1-管理用户" class="headerlink" title="1. 管理用户"></a>1. 管理用户</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">USE</span> mysql<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> <span class="token keyword">use</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>MySQL用户账号和信息存储在名为mysql的MySQL数据库中。mysql数据库有一个名为user的表，它包含所有用户账号。</p>
<h4 id="1-1-创建用户账号"><a href="#1-1-创建用户账号" class="headerlink" title="1.1 创建用户账号"></a>1.1 创建用户账号</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> ben IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'p@$$w0rd'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>CREATE USER创建一个用户账号，用IDENTIFIED BY给出了一个口令。</p>
<h4 id="1-2-重新命名用户"><a href="#1-2-重新命名用户" class="headerlink" title="1.2 重新命名用户"></a>1.2 重新命名用户</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">RENAME</span> <span class="token keyword">USER</span> ben <span class="token keyword">TO</span> bforta<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="1-3-删除用户账号"><a href="#1-3-删除用户账号" class="headerlink" title="1.3 删除用户账号"></a>1.3 删除用户账号</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">USER</span> bforta<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>MySQL5以后，DROP USER删除用户账号和所有相关的账号权限。</p>
<h3 id="2-访问权限"><a href="#2-访问权限" class="headerlink" title="2. 访问权限"></a>2. 访问权限</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> bforta<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>该语句可以查看用户bforta有哪些权限，输出显示</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">USAGE</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'bforta'</span><span class="token variable">@'%'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>结果表示bforta有一个权限USAGE ON <em>.</em>。USAGE表示根本没有权限。一般用户定义为user@host，这里输出中的%代表默认的主机名。</p>
<h4 id="2-1-GRANT的用法"><a href="#2-1-GRANT的用法" class="headerlink" title="2.1 GRANT的用法"></a>2.1 GRANT的用法</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> crashcourse<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> bforta<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此语句表示，允许用户bforta对crashcourse数据库中的所有数据具有只读访问权限。<br><strong>简化多次授权：</strong></p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> crashcourse<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> bforta<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="2-2-REVOKE的用法"><a href="#2-2-REVOKE的用法" class="headerlink" title="2.2 REVOKE的用法"></a>2.2 REVOKE的用法</h4><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> crashcourse<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> bforta<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这条语句代表取消刚刚赋予bforta的权限。</p>
<h4 id="2-3-GRANT和REVOKE"><a href="#2-3-GRANT和REVOKE" class="headerlink" title="2.3 GRANT和REVOKE"></a>2.3 GRANT和REVOKE</h4><p>GRANT和REVOKE可在几个层次上控制访问权限：</p>
<ul>
<li>整个服务器，使用GRANT ALL和REVOKE ALL;</li>
<li>整个数据库，使用ON database.*;</li>
<li>特定的表，使用ON database.table;</li>
<li>特定的列；</li>
<li>特定的存储过程。</li>
</ul>
<h3 id="3-更改口令"><a href="#3-更改口令" class="headerlink" title="3. 更改口令"></a>3. 更改口令</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> bforta <span class="token operator">=</span> Password<span class="token punctuation">(</span><span class="token string">'n3w p@$$w0rd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>SET PASSWORD更新用户口令。新口令必须传递到Password()函数进行加密。<br>SET PASSWORD还可以用来设置自己的口令。</p>
<pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">SET</span> PASSWORD <span class="token operator">=</span> Password<span class="token punctuation">(</span><span class="token string">'n3w p@$$w0rd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在不指定用户是，SET PASSWORD更新当前登录用户的口令。</p>
<h2 id="二十七-数据维护"><a href="#二十七-数据维护" class="headerlink" title="二十七.数据维护"></a>二十七.数据维护</h2><h3 id="1-备份数据"><a href="#1-备份数据" class="headerlink" title="1. 备份数据"></a>1. 备份数据</h3><ul>
<li>使用命令行程序mysqldump转储所有数据库内容到某个外部文件。在进行常规备份前这个实用程序应该正常运行，以便能正确地备份转储文件。</li>
<li>可用命令行实用程序mysqlhotcopy从一个数据库复制所有数据（并非所有数据库引擎都支持这个实用程序）。</li>
<li>可以使用MySQL的BACKUP TABLE或SELECT INTO OUTFILE转储所有数据到某个外部文件。这两条语句都接受将要创建的系统文件名，此系统文件必须不存在，否则会报错。数据可以用RESTORE TABLE来复原。</li>
</ul>
<h3 id="2-进行数据库维护"><a href="#2-进行数据库维护" class="headerlink" title="2. 进行数据库维护"></a>2. 进行数据库维护</h3><pre class="line-numbers language-sql"><code class="language-sql"><span class="token keyword">ANALYZE</span> <span class="token keyword">TABLE</span> orders<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>该语句可以返回该表的状态信息。</p>
<ul>
<li>CHECK TABLE用来针对许多问题对表进行检查。</li>
<li>CHANGED检查自最后一次检查以来改动过的表。</li>
<li>EXTENDED执行最彻底的检查</li>
<li>FAST只检查未正常关闭的表</li>
<li>MEDIUM检查所有被删除的连接并进行键检验</li>
<li>QUICK只进行快速扫描</li>
<li>如果MyISAM表访问产生不正确和不一致的结果，可能需要用REPAIR TABLE来修复相应的表</li>
<li>如果从一个表中删除大量数据，应该使用OPTIMIZE TABLE来收回所用的空间，从而优化表的性能</li>
</ul>
<h3 id="3-诊断启动问题"><a href="#3-诊断启动问题" class="headerlink" title="3. 诊断启动问题"></a>3. 诊断启动问题</h3><p>几个重要的mysqld命令行选型：</p>
<ul>
<li>–help显示帮助——一个选项列表</li>
<li>–safe-mode装载减去某些最佳配置的服务器</li>
<li>–verbose显示全文本信息</li>
<li>–version显示版本信息然后退出</li>
</ul>
<h3 id="4-查看日志文件"><a href="#4-查看日志文件" class="headerlink" title="4.查看日志文件"></a>4.查看日志文件</h3><ul>
<li>错误日志。它包含启动和关闭问题以及任意关键错误的细节。此日志通常名为hostname.err，位于data目录。此日志名可用–log-error命令行选项更改。</li>
<li>查询日志。它记录所有MySQL活动，在诊断问题时非常有用。此日志文件可能会很快地变得非常大，因此不应该长期使用它。此日志通常名为hostname.log，为于data目录中。此名字可以用–log命令行选项更改。</li>
<li>二进制文件。他记录更新过数据（或者可能更新过数据）的所有语句。此日志通常名为hostname-bin，位于data目录中。此名字可以用–log-bin命令行选项更改。注意，这个日志文件是MySQL5中添加的。</li>
<li>缓慢查询日志。此日志记录执行缓慢的任何查询。这个日志在确定数据库何处需要优化很有用。此日志通常名为hostname-slow.log，位于data目录中。此名字可以用–log-slow-queries命令行选项更改。</li>
</ul>
<p>在使用日志时，可用FLUSH LOGS语句来刷新和重新开始所有日志文件。</p>
<h2 id="二十八-改善性能"><a href="#二十八-改善性能" class="headerlink" title="二十八.改善性能"></a>二十八.改善性能</h2><ul>
<li>MySQL是用一系列的默认设置预先配置的，从这些设置开始通常是很好的。但过一段时间后你可能需要调整内存分配、缓冲区大小等。（为查看当前设置，可使用SHOW VARIABLES;和SHOW STATUS;）。</li>
<li>如果遇到显著的性能不良，可使用SHOW PROCESSLIST显示所有活动进程（以及它们的线程ID和执行时间）。开可以用KILL总结某个特定的进程。</li>
<li>总有不止一种方法编写用一条SELECT语句。应该实验联结、并、子查询等，找出最佳的方法。</li>
<li>使用SELECT语句和连接它们的UNION语句，代替SELECT语句中的OR条件。</li>
<li>LIKE很慢。一般来说，最好是使用FULLTEXT而不是LIKE。</li>
</ul>
<h2 id="二十九-MySQL数据类型"><a href="#二十九-MySQL数据类型" class="headerlink" title="二十九. MySQL数据类型"></a>二十九. MySQL数据类型</h2><h3 id="1-串数据类型"><a href="#1-串数据类型" class="headerlink" title="1. 串数据类型"></a>1. 串数据类型</h3><p><strong>定长串数据类型：</strong> CHAR属于定长串类型，它们分配的存储空间与指定的一样多。如CHAR(8)不管你存储内容的长度是多少，它所占空间就是8，如果存储内容长度大于8，则会被截取。<br><strong>变长串类型：</strong>变长串存储可变长度的文本，只有指定的数据得到保存。TEXT属于边长串类型<br>MySQL不允许对变长列进行索引。这会极大地影响性能。</p>
<table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">CHAR</td>
<td align="center">1~255个字符的定长串。它的长度必须在创建时指定，否则MySQL假定为CHAR(1)</td>
</tr>
<tr>
<td align="center">ENUM</td>
<td align="center">接受最多64K个串组成一个预定义集合的某个串</td>
</tr>
<tr>
<td align="center">LONGTEXT</td>
<td align="center">与TEXT相同，但最大长度为4GB</td>
</tr>
<tr>
<td align="center">MEDIUMTEXT</td>
<td align="center">与TEXT相同，但最大长度16K</td>
</tr>
<tr>
<td align="center">SET</td>
<td align="center">接受最多64个串组成的一个预定义集合的零个或多个串</td>
</tr>
<tr>
<td align="center">TEXT</td>
<td align="center">最大长度为64K的变长文本</td>
</tr>
<tr>
<td align="center">TINYTEXT</td>
<td align="center">与TEXT相同，但最大长度为255字节</td>
</tr>
<tr>
<td align="center">VACHAR</td>
<td align="center">长度可变，最多不超过255字节。如果创建时指定为VARCHAR(n)，则可存储0到n个字符的变长串(其中n≤255)</td>
</tr>
</tbody></table>
<p><strong>使用引号：</strong> 不管使用何种形式的串数据类型，串值都必须括在引号内(通常单引号更好)。</p>
<h3 id="2-数值数据类型"><a href="#2-数值数据类型" class="headerlink" title="2. 数值数据类型"></a>2. 数值数据类型</h3><p><strong>有符号或无符号：</strong> 所有数值类型(除BIT和BOOLEAN外)都可以有符号或无符号。如果不需要存储负值，可以使用UNSIGNED关键字，这样将允许你存储两倍大小的值。</p>
<table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BIT</td>
<td align="center">位字段，1~64位</td>
</tr>
<tr>
<td align="center">BIGINT</td>
<td align="center">整数值</td>
</tr>
<tr>
<td align="center">BOOLEAN</td>
<td align="center">布尔标志，或者为0或者为1</td>
</tr>
<tr>
<td align="center">DECIMAL</td>
<td align="center">精度可变的浮点值，DECIMAL(8,2): 8表示整数部分加小数部分的位数，2表示小数部分的位数</td>
</tr>
<tr>
<td align="center">DOUBLE</td>
<td align="center">双精度浮点数</td>
</tr>
<tr>
<td align="center">FLOAT</td>
<td align="center">单精度浮点数</td>
</tr>
<tr>
<td align="center">INT(或INTEGER)</td>
<td align="center">整数值</td>
</tr>
<tr>
<td align="center">MEDIUMINT</td>
<td align="center">整数值</td>
</tr>
<tr>
<td align="center">REAL</td>
<td align="center">4字节的浮点值</td>
</tr>
<tr>
<td align="center">SMALLINT</td>
<td align="center">整数值</td>
</tr>
<tr>
<td align="center">TINYINT</td>
<td align="center">整数值</td>
</tr>
</tbody></table>
<h3 id="3-日期和时间数据类型"><a href="#3-日期和时间数据类型" class="headerlink" title="3. 日期和时间数据类型"></a>3. 日期和时间数据类型</h3><table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">DATE</td>
<td align="center">表示1000~01~01——9999~12~31的日期，格式为YYYY-MM-DD</td>
</tr>
<tr>
<td align="center">DATATIME</td>
<td align="center">DATE和TIME的组合</td>
</tr>
<tr>
<td align="center">TIMESTAMP</td>
<td align="center">功能和DATETIME相同(但范围较小)</td>
</tr>
<tr>
<td align="center">TIME</td>
<td align="center">格式为HH:MM:SS</td>
</tr>
<tr>
<td align="center">YEAR</td>
<td align="center">用2位数字表示，范围是70(1970)~69(2069年)，用4位数字表示，范围是1901年~2155年</td>
</tr>
</tbody></table>
<h3 id="4-二进制数据类型"><a href="#4-二进制数据类型" class="headerlink" title="4. 二进制数据类型"></a>4. 二进制数据类型</h3><table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BLOB</td>
<td align="center">Blob最大长度为64KB</td>
</tr>
<tr>
<td align="center">MEDIUMBLOB</td>
<td align="center">Blob最大长度为16MB</td>
</tr>
<tr>
<td align="center">LONGBLOB</td>
<td align="center">Blob最大长度为4GB</td>
</tr>
<tr>
<td align="center">TINYBLOB</td>
<td align="center">Blob最大长度为255字节</td>
</tr>
</tbody></table>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><font color="#3299CC">《MySQL必知必会》</font></p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://www.codezhuang.top" rel="external nofollow noreferrer">李壮豪</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://www.codezhuang.top/2020/02/12/mysql/mysql-bi-zhi-bi-hui/">http://www.codezhuang.top/2020/02/12/mysql/mysql-bi-zhi-bi-hui/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="http://www.codezhuang.top" target="_blank">李壮豪</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/MySQL/">
                                    <span class="chip bg-color">MySQL</span>
                                </a>
                            
                                <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                                    <span class="chip bg-color">数据库</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.JPG" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: '45j5vNMbqRinH61qjbdoQp0w-gzGzoHsz',
        appKey: 'BFm0tC615FxDXcHBUNkpjArc',
        notify: 'true' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/02/17/vue/vue-chu-ti-yan/">
                    <div class="card-image">
                        
                        <img src="http://cdn.codezhuang.top/2_9.jpg" class="responsive-img" alt="Vue初体验">
                        
                        <span class="card-title">Vue初体验</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Vue基础知识点总结
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-02-17
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Vue/" class="post-category">
                                    Vue
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Vue/">
                        <span class="chip bg-color">Vue</span>
                    </a>
                    
                    <a href="/tags/JavaScript/">
                        <span class="chip bg-color">JavaScript</span>
                    </a>
                    
                    <a href="/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/">
                        <span class="chip bg-color">前端框架</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/02/02/springcloud/springcloud-chu-ti-yan/">
                    <div class="card-image">
                        
                        <img src="http://cdn.codezhuang.top/2_5.jpg" class="responsive-img" alt="SpringCloud初体验">
                        
                        <span class="card-title">SpringCloud初体验</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            微服务入门
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-02-02
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/SpringCloud/" class="post-category">
                                    SpringCloud
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/java/">
                        <span class="chip bg-color">java</span>
                    </a>
                    
                    <a href="/tags/SpringCloud/">
                        <span class="chip bg-color">SpringCloud</span>
                    </a>
                    
                    <a href="/tags/Spring/">
                        <span class="chip bg-color">Spring</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="http://www.codezhuang.top" target="_blank">李壮豪</a>
            <!-- |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a> -->
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/codinghit" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1444879567@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1444879567" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1444879567" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>
    <!-- 添加樱花飘落 -->
    <!-- <script src="https://cdn.jsdelivr.net/gh/wallleap/cdn@latest/js/sakura.js"></script> -->

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon.min.js" async="async"></script>
    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
